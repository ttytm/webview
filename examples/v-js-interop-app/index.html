<html>
	<head>
		<title>Emoji Picker Desktop App in under 50 lines of Code</title>
		<link rel="stylesheet" href="./style.css" />
	</head>
	<body>
		<div id="container">
			<h1>V webview examples</h1>
			<hr />
			<div>
				<h2>1. Simple V function Call</h2>
				<button onclick="handleToggle()">Toggle Setting <span id="toggle-state">on</span></button>
			</div>
			<div>
				<h2>2. Sent data to V</h2>
				<form id="login">
					<input placeholder="What's your name?" type="text" />
					<button type="submit">Submit</button>
				</form>
				<sub id="submit-info"></sub>
			</div>
			<div>
				<h2>3. Async operation in V</h2>
				<div>
					<h3>Simple things</h3>
					<p>Breathe some air. Drink some water. Write some code.</p>
				</div>
				<button onclick="fetchArticle()">Fetch Article</button>
			</div>
		</div>
		<script>
			let initialized = false;
			let settings = { toggle: false };
			const toggleState = document.querySelector('#toggle-state');
			const submitInfo = document.querySelector('#submit-info');
			const heading = document.querySelector('h3');
			const content = document.querySelector('p');

			// V functions (in the scope of this example, prefixed with `window.`)
			//
			// The `window.` prefix is not required. But it is a common pattern in webview examples.
			// For semantic reasons and to help distinguish functions as your project grows, this can be a helpful pattern.
			// Just use the style and convention you prefer when naming the webview JS functions.

			async function handleToggle() {
				// V function call
				toggleState.innerHTML = (await window.toggle_setting()) ? 'on' : 'off';
			}

			document.getElementById('login').addEventListener('submit', async (e) => {
				e.preventDefault();
				const user = document.querySelector('#login input').value;
				if (user.trim() === '') {
					submitInfo.innerHTML = 'Please enter a value';
					return;
				}
				// V function call
				const resp = await window.login(user);
				submitInfo.innerHTML = resp;
			});

			async function fetchArticle() {
				if (!initialized) {
					content.innerHTML = 'Error: not connected to V backend.';
					return;
				}
				heading.innerHTML = 'Loading';
				content.innerHTML = `<span class="dot one">.</span>
					<span class="dot two">.</span>
					<span class="dot three">.</span>`;
				// V function call
				const news = await window.fetch_news();
				heading.innerHTML = news.title;
				content.innerHTML = news.body;
			}

			(async () => {
				// V function call
				settings = await window.get_settings();
				toggleState.innerHTML = settings.toggle ? 'on' : 'off';
				initialized = true;
			})();
		</script>
	</body>
</html>
