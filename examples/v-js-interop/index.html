<html>
	<head>
		<title>Emoji Picker Desktop App in under 50 lines of Code</title>
		<link rel="stylesheet" href="./style.css" />
	</head>
	<body>
		<div id="container">
			<h1>V webview examples</h1>
			<hr />
			<div>
				<h2>1. Simple V function Call</h2>
				<button onclick="handleToggle()">Toggle Setting <span id="toggle-state">on</span></button>
			</div>
			<div>
				<h2>2. Sent data to V</h2>
				<form id="login">
					<input placeholder="What's your name?" type="text" />
					<button type="submit">Submit</button>
				</form>
				<sub id="submit-info"></sub>
			</div>
			<div>
				<h2>3. Async operation in V</h2>
				<div>
					<h3>Simple things</h3>
					<p>Breathe some air. Drink some water. Write some code.</p>
				</div>
				<button onclick="fetchArticle()">Fetch Article</button>
			</div>
		</div>
		<script>
			let initialized = false;
			const toggleState = document.querySelector('#toggle-state');
			const submitInfo = document.querySelector('#submit-info');
			const heading = document.querySelector('h3');
			const content = document.querySelector('p');

			/**
			 * A JS function that will be called by our V program.
			 * @param {Object} settings
			 * @param {boolean} settings.toggle
			 */
			function init(settings) {
				initialized = true;
				toggleState.innerHTML = settings.toggle ? 'on' : 'off';
				console.log('Initiated JS!');
			}

			// V function calls
			//
			// We don't need to use the `window.` prefix. But it is a common pattern in webview examples.
			// Here it is done for semantic reasons. It can help to make the origin more immediately visible
			// when things get more crowded. Alternatively, just keeping the `snake_case` function names
			// or adding a prefix `v_init_js`, might be sufficient to differentiate functions.
			// Just use the style you prefer.

			window.connect();

			async function handleToggle() {
				toggleState.innerHTML = (await window.toggle_setting()) ? 'on' : 'off';
			}

			document.getElementById('login').addEventListener('submit', async (e) => {
				e.preventDefault();
				const user = document.querySelector('#login input').value;
				if (user.trim() === '') {
					submitInfo.innerHTML = 'Please enter a value';
					return;
				}
				// Call V function
				const resp = await window.login(user);
				submitInfo.innerHTML = resp;
			});

			async function fetchArticle() {
				if (!initialized) {
					content.innerHTML = 'Error: not connected to V backend.';
					return;
				}
				heading.innerHTML = 'Loading';
				content.innerHTML = `<span class="dot one">.</span>
					<span class="dot two">.</span>
					<span class="dot three">.</span>`;
				// Call V function
				const news = await window.fetch_news();
				heading.innerHTML = news.title;
				content.innerHTML = news.body;
			}
		</script>
	</body>
</html>
